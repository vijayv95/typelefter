name: Generate Pull Request Description

on:
  # Triggers the workflow on pull request events
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main
      - master
      # Add any other target branches here

jobs:
  update_description:
    runs-on: ubuntu-latest
    steps:

      # Step 1: Check out the code
      # Required for the subsequent action to analyze commit history
      - uses: actions/checkout@v3

      # Step 2: Generate the pull request description
      - name: Generate PR Description
        uses: octue/generate-pull-request-description@1.0.0.beta-2 # Use the latest version or a specific tag
        id: pr-description
        with:
          # Required input: the URL of the pull request being processed
          pull_request_url: ${{ github.event.pull_request.url }}
          # Required input: a token with permission to read history
          api_token: ${{ secrets.GITHUB_TOKEN }}

      # Step 3: Update the pull request body with the generated output
      - name: Update pull request body
        uses: riskledger/update-pr-description@v2 # Use the stable V2 version
        with:
          # Pass the generated description output from Step 2 to the body input
          body: ${{ steps.pr-description.outputs.pull_request_description }}
          # Required input: a token with permission to write to the PR
          token: ${{ secrets.GITHUB_TOKEN }}
